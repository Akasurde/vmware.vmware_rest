---
- name: Get VM storage policy
  vcenter_vm_storage_policy_info:
    vm: '{{ test_vm1_info.id }}'
  register: _result

- debug: var=_result
- debug: var=test_vm1_info.value.disks[0].key

- name: Adjust VM storage policy
  vcenter_vm_storage_policy:
    vm: '{{ test_vm1_info.id }}'
    disks:
      - key: '{{ test_vm1_info.value.disks[0].key }}'
        value:
          type: USE_DEFAULT_POLICY
  register: _result

- debug: var=_result

- assert:
    that:
      - _result is changed

- name: Adjust VM storage policy (again)
  vcenter_vm_storage_policy:
    vm: '{{ test_vm1_info.id }}'
    disks:
      - key: '{{ test_vm1_info.value.disks[0].key }}'
        value:
          type: USE_DEFAULT_POLICY
  register: _result

- debug: var=_result

- assert:
    that:
      - not(_result is changed)
  ignore_errors: true

